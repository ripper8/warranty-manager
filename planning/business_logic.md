# Бизнес Логика - Warranty Manager

## 1. Общ Преглед
Приложението "Warranty Manager" служи за дигитализиране и управление на гаранционни карти. Основната цел е потребителите лесно да съхраняват информация за закупени продукти, да получават напомняния за изтичащи гаранции и да имат бърз достъп до документите (касови бележки, фактури) при нужда.

## 2. Потребителски Роли и Права

Системата поддържа йерархична структура с възможност един потребител да участва в множество акаунти (организации/домакинства).

### 2.1. Global Admin (Системен Администратор)
*   **Обхват**: Цялото приложение.
*   **Права**:
    *   Вижда статистика за всички регистрирани акаунти и потребители.
    *   Може да блокира/деактивира акаунти.
    *   Управлява глобални настройки на системата.
    *   **Управление на пароли**: Може да смени паролата на всеки потребител директно (без да знае старата).
    *   Достъп до Global Admin Panel.

### 2.2. Account Admin (Администратор на Акаунт)
*   **Обхват**: Конкретен Акаунт (напр. "Семейство Иванови" или "Фирма ООД").
*   **Права**:
    *   Управлява настройките на акаунта.
    *   Кани и премахва потребители от акаунта.
    *   Задава роли на потребителите вътре в акаунта.
    *   Вижда и управлява всички гаранции в акаунта.
    *   Вижда статистики за акаунта.

### 2.3. User (Потребител)
*   **Обхват**: Конкретен Акаунт.
*   **Права**:
    *   Добавя нови гаранционни карти.
    *   Разглежда и редактира гаранциите (според настройките, може да се ограничи само до добавените от него или всички в акаунта).
    *   Получава известия за изтичащи гаранции.
    *   **Смяна на парола**: Може да смени собствената си парола, като въведе стара и нова парола (не важи за Google OAuth потребители).

## 3. Основни Процеси (User Flows)

### 3.1. Регистрация и Вход (Onboarding)
1.  **Регистрация**:
    *   Опция 1: Email + Парола.
    *   Опция 2: Google OAuth (Опционално).
2.  **Създаване на Акаунт**:
    *   При първоначална регистрация, потребителят създава нов "Акаунт" (Workspace) и автоматично става негов **Account Admin**.
3.  **Покани (Invites)**:
    *   Account Admin може да изпрати покана по имейл към друг потребител.
    *   Ако потребителят вече има регистрация, той просто получава достъп до новия акаунт.
    *   Ако няма, минава през регистрация и директно влиза в акаунта.

### 3.2. Добавяне на Гаранция (Core Flow)
1.  **Старт**: Потребителят избира "Добави нова гаранция".
2.  **Снимки**:
    *   Снима/Качва снимка на **Гаранционна карта** (може повече от една).
    *   Снима/Качва снимка на **Касова бележка / Фактура** (може повече от една).
    *   (Опционално) Снима/Качва снимка на **Продукта** (може повече от една).
3.  **AI Обработка (FUTURE PHASE)**:
    *   *Забележка: Тази функционалност е планира за следваща итерация.*
    *   При качване на документ, системата може да предложи автоматично попълване.
4.  **Детайли**:
    *   Потребителят ръчно въвежда: Име на продукт, Категория (напр. Електроника, Мебели), Срок на гаранция (в месеци/години), Дата на закупуване.
    *   Системата автоматично изчислява "Дата на изтичане".
5.  **Запис**: Гаранцията се запазва в базата данни.

### 3.3. Напомняния (Notifications)
*   Системата следи датата на изтичане.
*   Изпраща известия (Email или Push) на конфигурируеми интервали:
    *   30 дни преди изтичане.
    *   7 дни преди изтичане.
    *   В деня на изтичане.

### 3.4. Търсене и Филтриране
*   **Филтри**: По категория, По статус (Активна/Изтичаща скоро/Изтекла), По Търговец.
*   **Търсене**: По име на продукт, марка или бележки.

## 4. Структура на Данните (Сущности)

*   **User**: ID, Email, PasswordHash, Name, Avatar, CreatedAt.
*   **Account**: ID, Name, OwnerID, CreatedAt.
*   **AccountUser**: AccountID, UserID, Role (Admin/User).
*   **WarrantyItem**:
    *   ID, AccountID, CreatedByUserID.
    *   Title, Category, Brand, Model.
    *   PurchaseDate, WarrantyPeriod (months), ExpiryDate.
    *   Price, Currency.
    *   MerchantName.
    *   Status (Active, Expired, Archived).
*   **Document**:
    *   ID, WarrantyItemID.
    *   Type (Receipt, WarrantyCard, ProductPhoto).
    *   URL (Local Storage Path).

## 5. Админ Панел (Global Admin)
*   Dashboard с метрики: Общ брой потребители, Общ брой качени гаранции, Активност през последните 30 дни.
*   Таблица с всички акаунти и възможност за управление.
*   **User Management**: Смяна на пароли на потребители.
