# Ğ ĞµĞ°Ğ»Ğ½Ğ° ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° - Warranty Manager

> ĞĞºÑ‚ÑƒĞ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ°Ğ½Ğ¾: 2025-11-22  
> Ğ¢Ğ¾Ğ·Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ Ğ¾Ğ¿Ğ¸ÑĞ²Ğ° Ñ€ĞµĞ°Ğ»Ğ½Ğ°Ñ‚Ğ° Ğ¸Ğ¼Ğ¿Ğ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ñ‚Ğ° ÑĞ»ĞµĞ´ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ°.

## ğŸ“‹ Ğ¡ÑŠĞ´ÑŠÑ€Ğ¶Ğ°Ğ½Ğ¸Ğµ
1. [Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµĞ½ Ğ¡Ñ‚ĞµĞº](#Ñ‚ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµĞ½-ÑÑ‚ĞµĞº)
2. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¸ Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¸](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¸-Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¸)
3. [Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ°](#ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°-Ğ½Ğ°-Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°)
4. [Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ğ¸](#Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ğ¸)
5. [ĞĞ²Ñ‚ĞµĞ½Ñ‚Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ](#Ğ°Ğ²Ñ‚ĞµĞ½Ñ‚Ğ¸ĞºĞ°Ñ†Ğ¸Ñ-Ğ¸-Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ)
6. [Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾ Ğ¡ÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ](#Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾-ÑÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ)
7. [API Endpoints](#api-endpoints)
8. [Deployment](#deployment)

---

## ğŸ›  Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµĞ½ Ğ¡Ñ‚ĞµĞº

### Frontend & Backend Framework
- **Next.js 16.0.3** (App Router)
  - Server Components Ğ·Ğ° Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ°Ğ»Ğ½Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»Ğ½Ğ¾ÑÑ‚
  - Server Actions Ğ·Ğ° Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¸ Ğ¼ÑƒÑ‚Ğ°Ñ†Ğ¸Ğ¸
  - TypeScript 5 Ğ·Ğ° type safety
- **React 19.2.0** Ñ React DOM 19.2.0

### UI & Styling
- **Tailwind CSS 4** - Utility-first CSS framework
- **Shadcn/ui** - ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¸ Ğ±Ğ°Ğ·Ğ¸Ñ€Ğ°Ğ½Ğ¸ Ğ½Ğ° Radix UI:
  - `@radix-ui/react-dialog`
  - `@radix-ui/react-dropdown-menu`
  - `@radix-ui/react-select`
  - `@radix-ui/react-avatar`
  - `@radix-ui/react-alert-dialog`
  - `@radix-ui/react-popover`
  - `@radix-ui/react-label`
  - `@radix-ui/react-slot`
- **Lucide React** - Ğ˜ĞºĞ¾Ğ½Ğ¸
- **next-themes** - Dark/Light mode Ğ¿Ğ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ°
- **class-variance-authority** + **clsx** + **tailwind-merge** - Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡Ğ½Ğ¾ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ĞºĞ»Ğ°ÑĞ¾Ğ²Ğµ

### Database & ORM
- **PostgreSQL 15** (Alpine Docker image)
- **Prisma 5.22.0** - ORM Ñ type-safe database client
- **@prisma/client** - Auto-generated client

### Authentication
- **NextAuth.js v5** (Auth.js beta.30)
- **@auth/prisma-adapter** - Prisma adapter Ğ·Ğ° Auth.js
- **bcryptjs** - Password hashing

### File Storage
- **MinIO** - S3-compatible object storage
- **@aws-sdk/client-s3** - AWS SDK Ğ·Ğ° S3 Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
- **UUID** - Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ°Ğ½Ğµ Ğ½Ğ° ÑƒĞ½Ğ¸ĞºĞ°Ğ»Ğ½Ğ¸ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¸ Ğ¸Ğ¼ĞµĞ½Ğ°

### Form Management
- **React Hook Form 7.66.1** - Form state management
- **@hookform/resolvers** - Validation resolvers
- **Zod 4.1.12** - Schema validation

### Utilities
- **date-fns 4.1.0** - Date manipulation
- **tw-animate-css** - Tailwind animations

### DevOps & Infrastructure
- **Docker** - Containerization
- **Docker Compose** - Multi-container orchestration
- **Nginx** - Reverse proxy (production)
- **Jenkins** - CI/CD pipeline

---

## ğŸ— ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¸ Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¸

### Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ğ° ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

```mermaid
graph TB
    subgraph "Client Layer"
        Browser[Web Browser / Mobile]
    end
    
    subgraph "Application Layer"
        NextJS[Next.js App Router]
        ServerComponents[Server Components]
        ServerActions[Server Actions]
        API[API Routes]
        Middleware[Auth Middleware]
    end
    
    subgraph "Authentication"
        AuthJS[Auth.js / NextAuth v5]
        CredProvider[Credentials Provider]
    end
    
    subgraph "Data Layer"
        Prisma[Prisma ORM]
        PostgreSQL[(PostgreSQL 15)]
    end
    
    subgraph "Storage Layer"
        S3Client[AWS S3 Client]
        MinIO[MinIO Object Storage]
    end
    
    Browser --> NextJS
    NextJS --> ServerComponents
    NextJS --> ServerActions
    NextJS --> API
    NextJS --> Middleware
    
    Middleware --> AuthJS
    ServerActions --> AuthJS
    AuthJS --> CredProvider
    CredProvider --> Prisma
    
    ServerComponents --> Prisma
    ServerActions --> Prisma
    API --> Prisma
    
    Prisma --> PostgreSQL
    
    ServerActions --> S3Client
    API --> S3Client
    S3Client --> MinIO
    
    style NextJS fill:#0070f3,color:#fff
    style PostgreSQL fill:#336791,color:#fff
    style MinIO fill:#C72E49,color:#fff
    style AuthJS fill:#7c3aed,color:#fff
```

### Data Flow - Ğ”Ğ¾Ğ±Ğ°Ğ²ÑĞ½Ğµ Ğ½Ğ° Ğ“Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ

```mermaid
sequenceDiagram
    participant User
    participant Browser
    participant NextJS
    participant ServerAction
    participant Prisma
    participant PostgreSQL
    participant S3Client
    participant MinIO

    User->>Browser: ĞŸĞ¾Ğ¿ÑŠĞ»Ğ²Ğ° Ñ„Ğ¾Ñ€Ğ¼Ğ° Ğ·Ğ° Ğ³Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ñ
    User->>Browser: ĞšĞ°Ñ‡Ğ²Ğ° Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸ (ÑĞ½Ğ¸Ğ¼ĞºĞ¸)
    Browser->>NextJS: POST /api/upload
    NextJS->>S3Client: uploadFile(buffer, mime)
    S3Client->>MinIO: PutObjectCommand
    MinIO-->>S3Client: Success (key)
    S3Client-->>NextJS: Return file key
    NextJS-->>Browser: Return file URL
    
    Browser->>ServerAction: createWarranty(data)
    ServerAction->>Prisma: Create WarrantyItem
    Prisma->>PostgreSQL: INSERT INTO WarrantyItem
    PostgreSQL-->>Prisma: Success
    Prisma->>PostgreSQL: INSERT INTO Document (with URLs)
    PostgreSQL-->>Prisma: Success
    Prisma-->>ServerAction: Return warranty
    ServerAction-->>Browser: Redirect to dashboard
    Browser-->>User: ĞŸĞ¾ĞºĞ°Ğ·Ğ²Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ ÑÑŠĞ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ
```

### User Authentication Flow

```mermaid
sequenceDiagram
    participant User
    participant LoginPage
    participant AuthJS
    participant CredProvider
    participant Prisma
    participant PostgreSQL

    User->>LoginPage: Ğ’ÑŠĞ²ĞµĞ¶Ğ´Ğ° email & password
    LoginPage->>AuthJS: signIn("credentials", {...})
    AuthJS->>CredProvider: authorize(credentials)
    CredProvider->>Prisma: findUnique(email)
    Prisma->>PostgreSQL: SELECT * FROM User
    PostgreSQL-->>Prisma: User data
    Prisma-->>CredProvider: User object
    CredProvider->>CredProvider: bcrypt.compare(password)
    alt Password Valid
        CredProvider-->>AuthJS: Return user
        AuthJS->>Prisma: Create Session
        Prisma->>PostgreSQL: INSERT INTO Session
        PostgreSQL-->>Prisma: Success
        AuthJS-->>LoginPage: Success
        LoginPage-->>User: Redirect to Dashboard
    else Password Invalid
        CredProvider-->>AuthJS: Return null
        AuthJS-->>LoginPage: Error
        LoginPage-->>User: Show error message
    end
```

### Role-Based Access Control

```mermaid
graph TD
    User[User Request] --> Middleware[Auth Middleware]
    Middleware --> CheckAuth{Authenticated?}
    
    CheckAuth -->|No| LoginPage[Redirect to Login]
    CheckAuth -->|Yes| CheckRole{Check Role}
    
    CheckRole --> GlobalAdmin{Global Admin?}
    CheckRole --> AccountAdmin{Account Admin?}
    CheckRole --> RegularUser{Regular User?}
    
    GlobalAdmin -->|Yes| AdminPanel[Access Admin Panel]
    GlobalAdmin -->|No| CheckAccountAdmin
    
    AccountAdmin -->|Yes| AccountSettings[Manage Account]
    AccountAdmin -->|No| CheckRegularUser
    
    RegularUser -->|Yes| Dashboard[Access Dashboard]
    RegularUser -->|No| Forbidden[403 Forbidden]
    
    CheckAccountAdmin[Check Account Admin]
    CheckRegularUser[Check Regular User]
    
    style GlobalAdmin fill:#ef4444,color:#fff
    style AccountAdmin fill:#f59e0b,color:#fff
    style RegularUser fill:#10b981,color:#fff
```

---

## ğŸ“ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ğ½Ğ° ĞŸÑ€Ğ¾ĞµĞºÑ‚Ğ°

```
warranty-manager/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                          # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ (dashboard)/              # Protected routes group
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/                # Global Admin Panel
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ accounts/         # Account management
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ users/            # User management
â”‚   â”‚   â”‚   â”œâ”€â”€ dashboard/            # Main dashboard
â”‚   â”‚   â”‚   â”œâ”€â”€ warranties/           # Warranty management
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/             # Warranty details
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ new/              # Add new warranty
â”‚   â”‚   â”‚   â”œâ”€â”€ settings/             # User settings
â”‚   â”‚   â”‚   â””â”€â”€ layout.tsx            # Dashboard layout
â”‚   â”‚   â”œâ”€â”€ api/                      # API Routes
â”‚   â”‚   â”‚   â”œâ”€â”€ upload/               # File upload endpoint
â”‚   â”‚   â”‚   â”œâ”€â”€ uploads/[filename]/   # File serving endpoint
â”‚   â”‚   â”‚   â””â”€â”€ auth/[...nextauth]/   # Auth endpoints
â”‚   â”‚   â”œâ”€â”€ login/                    # Login page
â”‚   â”‚   â”œâ”€â”€ register/                 # Registration page
â”‚   â”‚   â”œâ”€â”€ layout.tsx                # Root layout
â”‚   â”‚   â”œâ”€â”€ page.tsx                  # Landing page
â”‚   â”‚   â””â”€â”€ globals.css               # Global styles
â”‚   â”œâ”€â”€ components/                   # React components
â”‚   â”‚   â”œâ”€â”€ ui/                       # Shadcn UI components
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ dialog.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ select.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ warranty-card.tsx         # Custom components
â”‚   â”‚   â”œâ”€â”€ warranty-form.tsx
â”‚   â”‚   â”œâ”€â”€ user-nav.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ lib/                          # Utility libraries
â”‚   â”‚   â”œâ”€â”€ prisma.ts                 # Prisma client singleton
â”‚   â”‚   â”œâ”€â”€ storage.ts                # S3/MinIO operations
â”‚   â”‚   â”œâ”€â”€ utils.ts                  # Helper functions
â”‚   â”‚   â”œâ”€â”€ actions.ts                # Generic server actions
â”‚   â”‚   â”œâ”€â”€ warranty-actions.ts       # Warranty CRUD actions
â”‚   â”‚   â”œâ”€â”€ account-actions.ts        # Account management actions
â”‚   â”‚   â”œâ”€â”€ user-actions.ts           # User management actions
â”‚   â”‚   â”œâ”€â”€ admin-actions.ts          # Admin operations
â”‚   â”‚   â””â”€â”€ dashboard-actions.ts      # Dashboard data fetching
â”‚   â”œâ”€â”€ auth.ts                       # Auth.js configuration
â”‚   â”œâ”€â”€ auth.config.ts                # Auth.js config
â”‚   â””â”€â”€ middleware.ts                 # Next.js middleware (auth)
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma                 # Database schema
â”‚   â”œâ”€â”€ migrations/                   # Database migrations
â”‚   â””â”€â”€ seed.ts                       # Database seeding
â”œâ”€â”€ public/                           # Static assets
â”œâ”€â”€ docker-compose.yml                # Local development setup
â”œâ”€â”€ docker-compose.prod.yml           # Production setup
â”œâ”€â”€ Dockerfile                        # App container
â”œâ”€â”€ Jenkinsfile                       # CI/CD pipeline
â”œâ”€â”€ nginx/                            # Nginx configuration
â”œâ”€â”€ package.json                      # Dependencies
â”œâ”€â”€ tsconfig.json                     # TypeScript config
â”œâ”€â”€ tailwind.config.js                # Tailwind config
â””â”€â”€ next.config.ts                    # Next.js config
```

---

## ğŸ—„ Ğ‘Ğ°Ğ·Ğ° Ğ”Ğ°Ğ½Ğ½Ğ¸

### Prisma Schema Overview

```prisma
// ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¸ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
User              - ĞŸĞ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»Ğ¸ Ğ½Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ñ‚Ğ°
Account           - ĞĞºĞ°ÑƒĞ½Ñ‚Ğ¸ (Ğ¾Ñ€Ğ³Ğ°Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸/Ğ´Ğ¾Ğ¼Ğ°ĞºĞ¸Ğ½ÑÑ‚Ğ²Ğ°)
AccountUser       - Many-to-Many Ğ²Ñ€ÑŠĞ·ĞºĞ° User â†” Account Ñ Ñ€Ğ¾Ğ»Ğ¸
WarrantyItem      - Ğ“Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ¸ ĞºĞ°Ñ€Ñ‚Ğ¸
Document          - ĞŸÑ€Ğ¸ĞºĞ°Ñ‡ĞµĞ½Ğ¸ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ¸ ĞºÑŠĞ¼ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ğ¸

// Auth.js Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸
Session           - ĞŸĞ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»ÑĞºĞ¸ ÑĞµÑĞ¸Ğ¸
VerificationToken - Email verification tokens
```

### Entity Relationship Diagram

```mermaid
erDiagram
    User ||--o{ AccountUser : "has"
    Account ||--o{ AccountUser : "has"
    Account ||--o{ WarrantyItem : "contains"
    User ||--o{ WarrantyItem : "creates"
    WarrantyItem ||--o{ Document : "has"
    User ||--o{ Session : "has"
    User ||--o{ Account : "oauth"

    User {
        string id PK
        string email UK
        string password
        string name
        string image
        datetime createdAt
        datetime updatedAt
    }

    Account {
        string id PK
        string name
        string ownerId
        datetime createdAt
        datetime updatedAt
    }

    AccountUser {
        string id PK
        string accountId FK
        string userId FK
        enum role
    }

    WarrantyItem {
        string id PK
        string accountId FK
        string createdByUserId FK
        string title
        string category
        string brand
        string model
        datetime purchaseDate
        int warrantyPeriod
        datetime expiryDate
        decimal price
        string currency
        string merchantName
        string status
        datetime createdAt
        datetime updatedAt
    }

    Document {
        string id PK
        string warrantyItemId FK
        string type
        string url
        datetime createdAt
    }

    Session {
        string id PK
        string sessionToken UK
        string userId FK
        datetime expires
    }
```

### Ğ Ğ¾Ğ»Ğ¸ Ğ¸ ĞŸÑ€Ğ°Ğ²Ğ°

```typescript
enum Role {
  GLOBAL_ADMIN    // Ğ¡Ğ¸ÑÑ‚ĞµĞ¼ĞµĞ½ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€
  ACCOUNT_ADMIN   // ĞĞ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ½Ğ° Ğ°ĞºĞ°ÑƒĞ½Ñ‚
  USER            // ĞĞ±Ğ¸ĞºĞ½Ğ¾Ğ²ĞµĞ½ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»
}
```

**Ğ™ĞµÑ€Ğ°Ñ€Ñ…Ğ¸Ñ Ğ½Ğ° Ğ´Ğ¾ÑÑ‚ÑŠĞ¿:**
- `GLOBAL_ADMIN` â†’ Ğ”Ğ¾ÑÑ‚ÑŠĞ¿ Ğ´Ğ¾ Ğ²ÑĞ¸Ñ‡ĞºĞ¸ Ğ°ĞºĞ°ÑƒĞ½Ñ‚Ğ¸ Ğ¸ Ğ¿Ğ¾Ñ‚Ñ€ĞµĞ±Ğ¸Ñ‚ĞµĞ»Ğ¸
- `ACCOUNT_ADMIN` â†’ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚ĞµĞ½ Ğ°ĞºĞ°ÑƒĞ½Ñ‚
- `USER` â†’ Ğ”Ğ¾ÑÑ‚ÑŠĞ¿ ÑĞ°Ğ¼Ğ¾ Ğ´Ğ¾ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ğ¸Ñ‚Ğµ Ğ² Ğ°ĞºĞ°ÑƒĞ½Ñ‚Ğ°

---

## ğŸ” ĞĞ²Ñ‚ĞµĞ½Ñ‚Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### Auth.js (NextAuth v5) Setup

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:** `src/auth.config.ts` + `src/auth.ts`

**Providers:**
- **Credentials Provider** - Email/Password authentication
  - Password hashing Ñ `bcryptjs`
  - Custom authorize function

**Adapter:**
- `@auth/prisma-adapter` - Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ Prisma

**Session Strategy:**
- Database sessions (ÑÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸ Ğ² PostgreSQL)

**Middleware Protection:**
```typescript
// src/middleware.ts
export { auth as middleware } from "@/auth"

export const config = {
  matcher: ["/((?!api|_next/static|_next/image|favicon.ico).*)"],
}
```

**Role-Based Authorization:**
```typescript
// ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ² Server Actions
const session = await auth()
const accountUser = await prisma.accountUser.findFirst({
  where: {
    userId: session.user.id,
    accountId: accountId,
    role: { in: ['ACCOUNT_ADMIN', 'GLOBAL_ADMIN'] }
  }
})
```

---

## ğŸ“¦ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¾ Ğ¡ÑŠÑ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ

### MinIO (S3-Compatible Storage)

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ:**
```typescript
// src/lib/storage.ts
const s3 = new S3Client({
  endpoint: process.env.S3_ENDPOINT,      // http://localhost:9000
  region: process.env.S3_REGION,          // us-east-1
  credentials: {
    accessKeyId: process.env.S3_ACCESS_KEY_ID,
    secretAccessKey: process.env.S3_SECRET_ACCESS_KEY,
  },
  forcePathStyle: true, // MinIO compatibility
})
```

**ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸:**
1. **Upload:** `uploadFile(key, buffer, mime)` â†’ PutObjectCommand
2. **Delete:** `deleteFile(key)` â†’ DeleteObjectCommand
3. **Get URL:** `getFileUrl(key)` â†’ `/api/uploads/${filename}`

**File Serving:**
```typescript
// src/app/api/uploads/[filename]/route.ts
// Streaming files from MinIO to client
```

**Naming Convention:**
```
documents/{uuid}.{extension}
```

---

## ğŸŒ API Endpoints

### Public Routes
- `GET /` - Landing page
- `GET /login` - Login page
- `POST /login` - Login action
- `GET /register` - Registration page
- `POST /register` - Registration action

### Protected API Routes
- `POST /api/upload` - File upload to MinIO
- `GET /api/uploads/[filename]` - File serving from MinIO

### Server Actions (Server-Side)

**Warranty Actions** (`src/lib/warranty-actions.ts`):
- `createWarranty(data)` - Create new warranty
- `updateWarranty(id, data)` - Update warranty
- `deleteWarranty(id)` - Delete warranty
- `getWarranties(accountId)` - List warranties
- `getWarrantyById(id)` - Get single warranty

**Account Actions** (`src/lib/account-actions.ts`):
- `createAccount(data)` - Create account
- `updateAccount(id, data)` - Update account
- `deleteAccount(id)` - Delete account
- `addUserToAccount(accountId, userId, role)` - Add user
- `removeUserFromAccount(accountId, userId)` - Remove user

**Admin Actions** (`src/lib/admin-actions.ts`):
- `getAllAccounts()` - List all accounts (GLOBAL_ADMIN)
- `getAllUsers()` - List all users (GLOBAL_ADMIN)
- `changeUserPassword(userId, newPassword)` - Reset password

**User Actions** (`src/lib/user-actions.ts`):
- `updateUserProfile(data)` - Update profile
- `changePassword(oldPassword, newPassword)` - Change own password

---

## ğŸš€ Deployment

### Docker Compose Architecture

**Development** (`docker-compose.yml`):
```yaml
services:
  postgres:
    image: postgres:15-alpine
    ports: ["5440:5432"]
    
  minio:
    image: minio/minio:latest
    ports: ["9000:9000", "9001:9001"]
```

**Production** (`docker-compose.prod.yml`):
```yaml
services:
  app:
    build: .
    depends_on: [postgres, minio]
    
  nginx:
    image: nginx:alpine
    ports: ["80:80", "443:443"]
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
```

### CI/CD Pipeline (Jenkins)

**Jenkinsfile Stages:**
1. **Checkout** - Clone repository
2. **Build** - `docker build`
3. **Test** - Run tests (if any)
4. **Deploy** - `docker-compose up -d`
5. **Migrate** - `npx prisma migrate deploy`

### Environment Variables

```bash
# Database
DATABASE_URL="postgresql://user:pass@localhost:5440/warranty_db"

# Auth
AUTH_SECRET="random-secret-key"
AUTH_URL="http://localhost:3000"

# S3/MinIO
S3_ENDPOINT="http://localhost:9000"
S3_REGION="us-east-1"
S3_BUCKET="warranties"
S3_ACCESS_KEY_ID="minioadmin"
S3_SECRET_ACCESS_KEY="minioadmin"
```

---

## ğŸ“Š Performance Considerations

### Next.js Optimizations
- **Server Components** - Reduce client-side JavaScript
- **Streaming** - Progressive rendering
- **Image Optimization** - Next.js Image component
- **Static Generation** - Where applicable

### Database Optimizations
- **Indexes** - On foreign keys and frequently queried fields
- **Connection Pooling** - Prisma connection pool
- **Cascade Deletes** - Automatic cleanup

### Caching Strategy
- **Server Component Caching** - Automatic by Next.js
- **Revalidation** - `revalidatePath()` after mutations

---

## ğŸ”® Future Enhancements

1. **AI Integration** - OCR Ğ·Ğ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿ÑŠĞ»Ğ²Ğ°Ğ½Ğµ Ğ¾Ñ‚ ÑĞ½Ğ¸Ğ¼ĞºĞ¸
2. **Email Notifications** - ĞĞ°Ğ¿Ğ¾Ğ¼Ğ½ÑĞ½Ğ¸Ñ Ğ·Ğ° Ğ¸Ğ·Ñ‚Ğ¸Ñ‡Ğ°Ñ‰Ğ¸ Ğ³Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ğ¸
3. **Mobile App** - React Native Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ
4. **Multi-language** - i18n Ğ¿Ğ¾Ğ´Ğ´Ñ€ÑŠĞ¶ĞºĞ°
5. **Analytics** - Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¸ Ğ¾Ñ‚Ñ‡ĞµÑ‚Ğ¸
6. **Export** - PDF/Excel ĞµĞºÑĞ¿Ğ¾Ñ€Ñ‚ Ğ½Ğ° Ğ³Ğ°Ñ€Ğ°Ğ½Ñ†Ğ¸Ğ¸

---

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚ ÑÑŠĞ·Ğ´Ğ°Ğ´ĞµĞ½:** 2025-11-22  
**Ğ’ĞµÑ€ÑĞ¸Ñ:** 1.0  
**ĞĞ²Ñ‚Ğ¾Ñ€:** Development Team
